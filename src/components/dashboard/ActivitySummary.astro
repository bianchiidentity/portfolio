---
// æ´»å‹•ã‚µãƒãƒªãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
export type Props = {
  exerciseData: any[];
  bookData: any[];
  outputData: any[];
  exerciseMaxRecords: any;
  bookStats: any;
  outputStats: any;
};

const {
  exerciseData,
  bookData,
  outputData,
  exerciseMaxRecords,
  bookStats,
  outputStats,
} = Astro.props;

// ã‚¸ãƒ ã«è¡Œã£ãŸå›æ•°ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ãªæ—¥ä»˜æ•°ï¼‰ã‚’è¨ˆç®—
const uniqueGymDates = new Set(exerciseData.map((item) => (item as any).date));
const gymVisitCount = uniqueGymDates.size;

// å„ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚ºã®ç·å›æ•°ã‚’è¨ˆç®—
const exerciseTotalCounts: { [key: string]: number } = {};
exerciseData.forEach((item) => {
  const exerciseName = (item as any).exercise_name;
  if (!exerciseTotalCounts[exerciseName]) {
    exerciseTotalCounts[exerciseName] = 0;
  }
  exerciseTotalCounts[exerciseName] += (item as any).count || 0;
});
---

<section
  class="m-0 relative z-1 animate-fadeInUp animation-delay-300 block visible opacity-100 w-full box-border"
>
  <h2 class="text-2xl font-bold text-white mb-4 text-center drop-shadow-lg">
    ğŸ† æ´»å‹•ã‚µãƒãƒªãƒ¼
  </h2>
  <div class="grid grid-cols-1 gap-3">
    <div
      class="bg-white/95 rounded-xl p-4 shadow-lg backdrop-blur-sm border border-white/20 flex items-center gap-3 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl"
    >
      <div
        class="text-3xl w-12 h-12 flex items-center justify-center bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl text-white flex-shrink-0"
      >
        ğŸ’ª
      </div>
      <div class="flex-1">
        <h3 class="text-lg font-bold text-gray-800 m-0 mb-2">ç­‹ãƒˆãƒ¬</h3>
        <div class="flex flex-col gap-1">
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600 font-medium"
              >ã‚¸ãƒ ã«è¡Œã£ãŸå›æ•°</span
            >
            <span class="text-base text-gray-800 font-semibold"
              >{gymVisitCount}å›</span
            >
          </div>
          {
            Object.entries(exerciseMaxRecords).map(([exerciseName, record]) => (
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600 font-medium">
                  {exerciseName}
                </span>
                <span class="text-base text-gray-800 font-semibold">
                  æœ€å¤§{(record as any).maxWeight}kg / ç·
                  {exerciseTotalCounts[exerciseName] || 0}å›
                </span>
              </div>
            ))
          }
        </div>
      </div>
    </div>

    <div
      class="bg-white/95 rounded-xl p-4 shadow-lg backdrop-blur-sm border border-white/20 flex items-center gap-3 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl"
    >
      <div
        class="text-3xl w-12 h-12 flex items-center justify-center bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl text-white flex-shrink-0"
      >
        ğŸ“š
      </div>
      <div class="flex-1">
        <h3 class="text-lg font-bold text-gray-800 m-0 mb-2">èª­æ›¸</h3>
        <div class="flex flex-col gap-1">
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600 font-medium">åˆè¨ˆæ—¥æ•°</span>
            <span class="text-base text-gray-800 font-semibold"
              >{bookData.length}æ—¥</span
            >
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600 font-medium">åˆè¨ˆå†Šæ•°</span>
            <span class="text-base text-gray-800 font-semibold"
              >{Object.keys(bookStats).length}å†Š</span
            >
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600 font-medium">ç·ãƒšãƒ¼ã‚¸</span>
            <span class="text-base text-gray-800 font-semibold"
              >{
                bookData.reduce(
                  (sum, item) => sum + ((item as any).pages_read || 0),
                  0
                )
              }ãƒšãƒ¼ã‚¸</span
            >
          </div>
        </div>
      </div>
    </div>

    <div
      class="bg-white/95 rounded-xl p-4 shadow-lg backdrop-blur-sm border border-white/20 flex items-center gap-3 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl"
    >
      <div
        class="text-3xl w-12 h-12 flex items-center justify-center bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl text-white flex-shrink-0"
      >
        âœï¸
      </div>
      <div class="flex-1">
        <h3 class="text-lg font-bold text-gray-800 m-0 mb-2">ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ</h3>
        <div class="flex flex-col gap-1">
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600 font-medium">åˆè¨ˆæ—¥æ•°</span>
            <span class="text-base text-gray-800 font-semibold"
              >{outputData.length}æ—¥</span
            >
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600 font-medium">åˆè¨ˆè¨˜äº‹æ•°</span>
            <span class="text-base text-gray-800 font-semibold"
              >{Object.keys(outputStats).length}è¨˜äº‹</span
            >
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600 font-medium">ç·æ–‡å­—æ•°</span>
            <span class="text-base text-gray-800 font-semibold"
              >{
                outputData.reduce(
                  (sum, item) => sum + ((item as any).chars || 0),
                  0
                )
              }æ–‡å­—</span
            >
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  @layer components {
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fadeInUp {
      animation: fadeInUp 0.8s ease-out;
    }

    .animation-delay-300 {
      animation-delay: 0.3s;
    }

    @media (max-width: 768px) {
      .summary-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .summary-card {
        padding: 1.5rem;
      }

      .summary-icon {
        width: 60px;
        height: 60px;
        font-size: 2rem;
      }
    }

    @media (max-width: 480px) {
      .summary-card {
        flex-direction: column;
        text-align: center;
        padding: 1.5rem;
      }

      .summary-stats {
        width: 100%;
      }
    }
  }
</style>
