---
// 活動サマリーコンポーネント
export type Props = {
  exerciseData: any[];
  bookData: any[];
  outputData: any[];
  exerciseMaxRecords: any;
  bookStats: any;
  outputStats: any;
};

const {
  exerciseData,
  bookData,
  outputData,
  exerciseMaxRecords,
  bookStats,
  outputStats,
} = Astro.props;

// ジムに行った回数（ユニークな日付数）を計算
const uniqueGymDates = new Set(exerciseData.map((item) => (item as any).date));
const gymVisitCount = uniqueGymDates.size;

// 各エクササイズの総回数を計算
const exerciseTotalCounts: { [key: string]: number } = {};
exerciseData.forEach((item) => {
  const exerciseName = (item as any).exercise_name;
  if (!exerciseTotalCounts[exerciseName]) {
    exerciseTotalCounts[exerciseName] = 0;
  }
  exerciseTotalCounts[exerciseName] += (item as any).count || 0;
});
---

<section
  class="m-0 relative z-1 animate-fadeInUp animation-delay-300 block visible opacity-100 w-full box-border"
>
  <h2 class="text-2xl font-bold text-white mb-4 text-center drop-shadow-lg">
    🏆 活動サマリー
  </h2>
  <div class="grid grid-cols-1 gap-3">
    <div
      class="bg-white/95 rounded-xl p-4 shadow-lg backdrop-blur-sm border border-white/20 flex items-center gap-3 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl"
    >
      <div
        class="text-3xl w-12 h-12 flex items-center justify-center bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl text-white flex-shrink-0"
      >
        💪
      </div>
      <div class="flex-1">
        <h3 class="text-lg font-bold text-gray-800 m-0 mb-2">筋トレ</h3>
        <div class="flex flex-col gap-1">
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600 font-medium"
              >ジムに行った回数</span
            >
            <span class="text-base text-gray-800 font-semibold"
              >{gymVisitCount}回</span
            >
          </div>
          {
            Object.entries(exerciseMaxRecords).map(([exerciseName, record]) => (
              <div class="flex justify-between items-center">
                <span class="text-sm text-gray-600 font-medium">
                  {exerciseName}
                </span>
                <span class="text-base text-gray-800 font-semibold">
                  最大{(record as any).maxWeight}kg / 総
                  {exerciseTotalCounts[exerciseName] || 0}回
                </span>
              </div>
            ))
          }
        </div>
      </div>
    </div>

    <div
      class="bg-white/95 rounded-xl p-4 shadow-lg backdrop-blur-sm border border-white/20 flex items-center gap-3 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl"
    >
      <div
        class="text-3xl w-12 h-12 flex items-center justify-center bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl text-white flex-shrink-0"
      >
        📚
      </div>
      <div class="flex-1">
        <h3 class="text-lg font-bold text-gray-800 m-0 mb-2">読書</h3>
        <div class="flex flex-col gap-1">
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600 font-medium">合計日数</span>
            <span class="text-base text-gray-800 font-semibold"
              >{bookData.length}日</span
            >
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600 font-medium">合計冊数</span>
            <span class="text-base text-gray-800 font-semibold"
              >{Object.keys(bookStats).length}冊</span
            >
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600 font-medium">総ページ</span>
            <span class="text-base text-gray-800 font-semibold"
              >{
                bookData.reduce(
                  (sum, item) => sum + ((item as any).pages_read || 0),
                  0
                )
              }ページ</span
            >
          </div>
        </div>
      </div>
    </div>

    <div
      class="bg-white/95 rounded-xl p-4 shadow-lg backdrop-blur-sm border border-white/20 flex items-center gap-3 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl"
    >
      <div
        class="text-3xl w-12 h-12 flex items-center justify-center bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl text-white flex-shrink-0"
      >
        ✍️
      </div>
      <div class="flex-1">
        <h3 class="text-lg font-bold text-gray-800 m-0 mb-2">アウトプット</h3>
        <div class="flex flex-col gap-1">
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600 font-medium">合計日数</span>
            <span class="text-base text-gray-800 font-semibold"
              >{outputData.length}日</span
            >
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600 font-medium">合計記事数</span>
            <span class="text-base text-gray-800 font-semibold"
              >{Object.keys(outputStats).length}記事</span
            >
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600 font-medium">総文字数</span>
            <span class="text-base text-gray-800 font-semibold"
              >{
                outputData.reduce(
                  (sum, item) => sum + ((item as any).chars || 0),
                  0
                )
              }文字</span
            >
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  @layer components {
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fadeInUp {
      animation: fadeInUp 0.8s ease-out;
    }

    .animation-delay-300 {
      animation-delay: 0.3s;
    }

    @media (max-width: 768px) {
      .summary-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .summary-card {
        padding: 1.5rem;
      }

      .summary-icon {
        width: 60px;
        height: 60px;
        font-size: 2rem;
      }
    }

    @media (max-width: 480px) {
      .summary-card {
        flex-direction: column;
        text-align: center;
        padding: 1.5rem;
      }

      .summary-stats {
        width: 100%;
      }
    }
  }
</style>
